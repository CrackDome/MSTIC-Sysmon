<!--
  Technique: Server Software Component: Web Shell
  References:
  - https://attack.mitre.org/techniques/T1505/003/
  - https://github.com/SigmaHQ/sigma/blob/231b54e526bdfb2d991f0062e4c5d6621b3e4dd7/rules/linux/process_creation/lnx_webshell_detection.yml
-->
<Sysmon schemaversion="4.81">
  <EventFiltering>
    <RuleGroup name="" groupRelation="and">
      <ProcessCreate onmatch="include">
        <Rule name="" groupRelation="or">
            <Image condition="end with">whoami</Image>
            <Image condition="end with">ifconfig</Image>
            <Image condition="end with">/usr/bin/ip</Image>
            <Image condition="end with">/bin/uname</Image>
        </Rule>
        <Rule name="" groupRelation="or">
            <!-- General -->
            <ParentImage condition="end with">httpd</ParentImage>
            <ParentImage condition="end with">lighttpd</ParentImage>
            <ParentImage condition="end with">nginx</ParentImage>
            <ParentImage condition="end with">apache2</ParentImage>
            <ParentImage condition="end with">node</ParentImage>
            <!-- Tomcat -->
            <ParentCommandLine condition="contains">/bin/java</ParentCommandLine>
            <ParentCommandLine condition="contains">tomcat</ParentCommandLine>
        </Rule>
      </ProcessCreate>
    </RuleGroup>
  </EventFiltering>
</Sysmon>